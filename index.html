<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üî• Monad Pulse Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* Your CSS styles here */
  </style>
</head>
<body>

  <header>
    <a href="https://x.com/pawansatoshix" target="_blank"><img src="fox_logo.png" alt="Fox Logo"></a>
    <a href="https://monad.xyz" target="_blank"><img src="monad_logo.png" alt="Monad Logo"></a>
  </header>

  <h1>üî• Monad Pulse ü¶ä</h1>

  <div class="wallet-section">
    <button onclick="connectWallet()">Connect Wallet</button>
    <input type="text" id="manualWallet" placeholder="Enter wallet address"/>
    <button onclick="fetchManualWallet()">Search Wallet</button>
    <p id="walletAddress">-</p>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Wallet Tracker</h2>
      <p id="walletBalance">Balance: -</p>
      <p id="txCount">Tx Count: -</p>
    </div>

    <div class="card">
      <h2>Recent Transactions</h2>
      <div id="recentTxs">-</div>
    </div>

    <div class="card">
      <h2>Gas Fee Visualizer</h2>
      <button onclick="fetchGasData()">Refresh Gas</button>
      <p id="gasInfo">-</p>
    </div>
  </div>

  <div class="channels">
    <a href="https://t.me/pawansatoshiji" target="_blank">Telegram</a>
    <a href="https://youtube.com/@PawanSatoshi" target="_blank">YouTube</a>
    <a href="https://x.com/pawansatoshix" target="_blank">X / Twitter</a>
    <a href="https://discord.gg/monad" target="_blank">@pawansatoshi<br>(Discord)</a>
  </div>

  <footer>Built with ‚ù§Ô∏è on Monad Testnet | Contact: @pawansatoshi</footer>

  <script src="https://cdn.jsdelivr.net/npm/ethers@6.8.1/dist/ethers.min.js"></script>
  <script>
    let account;
    let refreshTimer;
    let lastTxs = [];
    const ANKR_RPC = "https://rpc.ankr.com/monad_testnet"; // Free unlimited Ankr RPC
    const provider = new ethers.JsonRpcProvider(ANKR_RPC);

    async function connectWallet() {
      if (!window.ethereum) {
        alert("MetaMask not detected!");
        return;
      }
      const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
      if (accounts.length === 0) {
        alert("No account found!");
        return;
      }
      account = accounts[0];
      document.getElementById("walletAddress").innerText = "Connected: " + account;
      await fetchWalletData(account);
      startAutoRefresh(account);
      window.ethereum.on("accountsChanged", (accounts) => {
        if (accounts.length === 0) {
          account = null;
          document.getElementById("walletAddress").innerText = "-";
        } else {
          account = accounts[0];
          document.getElementById("walletAddress").innerText = "Connected: " + account;
          fetchWalletData(account);
        }
      });
    }

    async function fetchManualWallet() {
      const manualAddress = document.getElementById("manualWallet").value.trim();
      if (!manualAddress) {
        alert("Enter a valid wallet address!");
        return;
      }
      account = manualAddress;
      document.getElementById("walletAddress").innerText = "Manual: " + account;
      await fetchWalletData(account);
      startAutoRefresh(account);
    }

    function startAutoRefresh(addr) {
      if (refreshTimer) clearInterval(refreshTimer);
      refreshTimer = setInterval(async () => {
        await fetchWalletData(addr);
        await fetchGasData();
      }, 15000);
    }

    async function fetchWalletData(address) {
      try {
        const balance = await provider.getBalance(address);
        const txCount = await provider.getTransactionCount(address);
        document.getElementById("walletBalance").innerText = "Balance: " + ethers.formatEther(balance).slice(0, 8) + " MON";
        document.getElementById("txCount").innerText = "Tx Count: " + txCount;

        const blockNumber = await provider.getBlockNumber();
        const txs = [];
        for (let i = blockNumber; i > blockNumber - 100 && txs.length < 5; i--) {
          const block = await provider.getBlockWithTransactions(i);
          block.transactions.forEach(tx => {
            if (tx.from.toLowerCase() === address.toLowerCase() || tx.to?.toLowerCase() === address.toLowerCase()) {
              txs.push(tx);
            }
          });
        }

        const recentTxsContainer = document.getElementById("recentTxs");
        recentTxsContainer.innerHTML = "";
        txs.forEach(tx => {
          const txElement = document.createElement("div");
          txElement.classList.add("tx");
          txElement.innerHTML = `
            <p><strong>Hash:</strong> <a href="https://testnet.explorer.monad.xyz/tx/${tx.hash}" target="_blank">${tx.hash}</a></p>
            <p><strong>From:</strong> ${tx.from}</p>
            <p><strong>To:</strong> ${tx.to}</p>
            <p><strong>Value:</strong> ${ethers.formatEther(tx.value).slice(0, 8)} MON</p>
          `;
          recentTxsContainer.appendChild(txElement);
        });

        if (txs.length > 0) {
          const newTxs = txs.filter(tx => !lastTxs.some(lastTx => lastTx.hash === tx.hash));
          newTxs.forEach(tx => {
            const txElement = document.createElement("div");
            txElement.classList.add("tx", "tx-new");
            txElement.innerHTML = `
              <p><strong>New Tx!</strong> <a href="https://testnet.explorer.monad.xyz/tx/${tx.hash}" target="_blank">${tx.hash}</a></p>
            `;
            recentTxsContainer.insertBefore(txElement, recentTxsContainer.firstChild);
          });
          lastTxs = txs;
        }
      } catch (error) {
        console.error("Error fetching wallet data:", error);
      }
    }

    async function fetchGasData() {
      try {
        const gasPrice = await provider.getGasPrice();
        const gasInfo = document.getElementById("gasInfo");
        gasInfo.innerText = "Gas Price: " + ethers.formatUnits(gasPrice, "gwei") + " Gwei";
      } catch (error) {
        console.error("Error fetching gas data:", error);
      }
    }
  </script>
</body>
  </html>
